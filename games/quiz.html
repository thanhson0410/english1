<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Quiz - Tr·∫Øc Nghi·ªám Ng·ªØ Ph√°p</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        .question-card {
            background: #fff;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #2d6cdf;
        }
        .timer {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-align: center;
            font-weight: bold;
            margin: 10px 0;
        }
        .explanation {
            background: #e8f4f8;
            border-left: 4px solid #2d6cdf;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            display: none;
        }
        .explanation.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <header>
        <h1>Grammar Quiz - Tr·∫Øc Nghi·ªám Ng·ªØ Ph√°p</h1>
        <nav>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="games.html">Grammar Games</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <div id="quiz-start">
            <div class="game-container">
                <h2>üß† Ki·ªÉm Tra Ki·∫øn Th·ª©c Ng·ªØ Ph√°p</h2>
                <p>B√†i quiz g·ªìm 15 c√¢u h·ªèi v·ªÅ c√°c ch·ªß ƒë·ªÅ ng·ªØ ph√°p c∆° b·∫£n ƒë·∫øn n√¢ng cao. M·ªói c√¢u c√≥ 30 gi√¢y ƒë·ªÉ tr·∫£ l·ªùi.</p>
                <div style="text-align: center;">
                    <button onclick="startQuiz()" class="quiz-button">B·∫Øt ƒê·∫ßu Quiz</button>
                </div>
            </div>
        </div>

        <div id="quiz-area" style="display: none;">
            <div class="question-counter">
                <span>C√¢u <span id="current-q">1</span> / <span id="total-q">15</span></span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
            </div>
            
            <div class="timer" id="timer">‚è∞ Th·ªùi gian: 30s</div>
            
            <div class="question-card">
                <h3 id="question"></h3>
                <div id="options"></div>
                <div id="explanation" class="explanation"></div>
            </div>
            
            <div class="score-display">
                <span>ƒêi·ªÉm: <span id="score">0</span> / <span id="max-score">15</span></span>
            </div>
        </div>

        <div id="final-results" style="display: none;">
            <div class="game-container">
                <h2>üéâ K·∫øt Qu·∫£ Quiz</h2>
                <div class="score-display">
                    <h3>ƒêi·ªÉm C·ªßa B·∫°n: <span id="final-score"></span></h3>
                    <div class="star-rating" id="star-rating"></div>
                </div>
                <div id="performance-analysis"></div>
                <div id="achievements"></div>
                <button onclick="restartQuiz()" class="quiz-button">L√†m L·∫°i Quiz</button>
                <a href="../grammar-lessons/lessons.html" class="quiz-button">√în T·∫≠p L√Ω Thuy·∫øt</a>
            </div>
        </div>
    </main>

    <script>
        const questions = [
            {
                question: "She _____ to school every day.",
                options: ["go", "goes", "going", "gone"],
                correct: 1,
                explanation: "V·ªõi ch·ªß ng·ªØ 'she' (s·ªë √≠t, ng√¥i th·ª© 3), ƒë·ªông t·ª´ ph·∫£i th√™m 's/es'. Present Simple: S + V(s/es)",
                topic: "Present Simple"
            },
            {
                question: "They _____ not like coffee.",
                options: ["do", "does", "did", "doing"],
                correct: 0,
                explanation: "V·ªõi ch·ªß ng·ªØ 'they' (s·ªë nhi·ªÅu), d√πng 'do' cho c√¢u ph·ªß ƒë·ªãnh. They do not = They don't",
                topic: "Present Simple"
            },
            {
                question: "_____ he work here?",
                options: ["Do", "Does", "Is", "Did"],
                correct: 1,
                explanation: "V·ªõi ch·ªß ng·ªØ 'he' (s·ªë √≠t, ng√¥i th·ª© 3), d√πng 'Does' cho c√¢u h·ªèi trong th√¨ hi·ªán t·∫°i ƒë∆°n",
                topic: "Present Simple"
            },
            {
                question: "I _____ a book yesterday.",
                options: ["read", "reads", "reading", "will read"],
                correct: 0,
                explanation: "'Yesterday' l√† d·∫•u hi·ªáu c·ªßa th√¨ qu√° kh·ª© ƒë∆°n. 'Read' c√≥ d·∫°ng qu√° kh·ª© gi·ªëng hi·ªán t·∫°i nh∆∞ng ph√°t √¢m kh√°c",
                topic: "Past Simple"
            },
            {
                question: "She _____ cooking when I arrived.",
                options: ["cook", "cooks", "was cooking", "cooked"],
                correct: 2,
                explanation: "H√†nh ƒë·ªông ƒëang di·ªÖn ra (was cooking) khi h√†nh ƒë·ªông kh√°c x·∫£y ra (arrived). Past Continuous + Past Simple",
                topic: "Past Continuous"
            },
            {
                question: "I _____ to London next week.",
                options: ["go", "went", "will go", "going"],
                correct: 2,
                explanation: "'Next week' l√† d·∫•u hi·ªáu t∆∞∆°ng lai. D√πng 'will + V' ƒë·ªÉ di·ªÖn t·∫£ k·∫ø ho·∫°ch t∆∞∆°ng lai",
                topic: "Future Simple"
            },
            {
                question: "You _____ speak louder. I can't hear you.",
                options: ["should", "would", "could", "might"],
                correct: 0,
                explanation: "'Should' d√πng ƒë·ªÉ ƒë∆∞a ra l·ªùi khuy√™n. 'B·∫°n n√™n n√≥i to h∆°n'",
                topic: "Modal Verbs"
            },
            {
                question: "This house _____ built in 1990.",
                options: ["is", "was", "has", "have"],
                correct: 1,
                explanation: "C√¢u b·ªã ƒë·ªông ·ªü qu√° kh·ª©: S + was/were + V3. 'Built' l√† qu√° kh·ª© ph√¢n t·ª´ c·ªßa 'build'",
                topic: "Passive Voice"
            },
            {
                question: "If I _____ rich, I would travel the world.",
                options: ["am", "was", "were", "will be"],
                correct: 2,
                explanation: "C√¢u ƒëi·ªÅu ki·ªán lo·∫°i 2: If + S + were/V2, S + would + V. D√πng 'were' cho t·∫•t c·∫£ ch·ªß ng·ªØ",
                topic: "Conditionals"
            },
            {
                question: "The book _____ you gave me is very interesting.",
                options: ["who", "which", "where", "when"],
                correct: 1,
                explanation: "'Which' d√πng ƒë·ªÉ thay th·∫ø cho danh t·ª´ ch·ªâ v·∫≠t (the book) trong m·ªánh ƒë·ªÅ quan h·ªá",
                topic: "Relative Clauses"
            },
            {
                question: "I have _____ money left.",
                options: ["few", "little", "a few", "a little"],
                correct: 3,
                explanation: "'Money' l√† danh t·ª´ kh√¥ng ƒë·∫øm ƒë∆∞·ª£c, d√πng 'a little' (m·ªôt √≠t) ho·∫∑c 'little' (r·∫•t √≠t)",
                topic: "Quantifiers"
            },
            {
                question: "She is good _____ mathematics.",
                options: ["in", "at", "on", "with"],
                correct: 1,
                explanation: "'Good at' l√† c·ª•m c·ªë ƒë·ªãnh c√≥ nghƒ©a l√† 'gi·ªèi v·ªÅ m√¥n g√¨ ƒë√≥'",
                topic: "Prepositions"
            },
            {
                question: "This is _____ book I've ever read.",
                options: ["the best", "better", "good", "the better"],
                correct: 0,
                explanation: "So s√°nh nh·∫•t v·ªõi t√≠nh t·ª´ ng·∫Øn: the + adj + est. 'Good' c√≥ d·∫°ng so s√°nh nh·∫•t l√† 'the best'",
                topic: "Comparatives"
            },
            {
                question: "I enjoy _____ music in my free time.",
                options: ["listen", "to listen", "listening", "listened"],
                correct: 2,
                explanation: "'Enjoy' lu√¥n ƒë∆∞·ª£c theo sau b·ªüi V-ing. Enjoy + V-ing",
                topic: "Gerunds"
            },
            {
                question: "He said that he _____ tired.",
                options: ["is", "was", "were", "be"],
                correct: 1,
                explanation: "C√¢u t∆∞·ªùng thu·∫≠t: khi ƒë·ªông t·ª´ t∆∞·ªùng thu·∫≠t ·ªü qu√° kh·ª© (said), ƒë·ªông t·ª´ trong m·ªánh ƒë·ªÅ ph·ª• l√πi th√¨",
                topic: "Reported Speech"
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let timeLeft = 30;
        let timer;
        let answered = false;
        let topicStats = {};

        function startQuiz() {
            document.getElementById('quiz-start').style.display = 'none';
            document.getElementById('quiz-area').style.display = 'block';
            currentQuestion = 0;
            score = 0;
            answered = false;
            topicStats = {};
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestion >= questions.length) {
                showResults();
                return;
            }

            const q = questions[currentQuestion];
            answered = false;
            timeLeft = 30;
            
            document.getElementById('current-q').textContent = currentQuestion + 1;
            document.getElementById('question').textContent = q.question;
            
            const optionsHTML = q.options.map((option, index) => 
                `<button class="quiz-button" onclick="selectAnswer(${index})">${option}</button>`
            ).join('');
            document.getElementById('options').innerHTML = optionsHTML;
            
            document.getElementById('explanation').classList.remove('show');
            
            const progress = (currentQuestion / questions.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
            
            startTimer();
        }

        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = `‚è∞ Th·ªùi gian: ${timeLeft}s`;
                
                if (timeLeft <= 10) {
                    document.getElementById('timer').style.background = 'linear-gradient(135deg, #ff3838 0%, #ff1744 100%)';
                } else {
                    document.getElementById('timer').style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)';
                }
                
                if (timeLeft <= 0) {
                    if (!answered) {
                        selectAnswer(-1); // timeout
                    }
                }
            }, 1000);
        }

        function selectAnswer(selectedIndex) {
            if (answered) return;
            
            answered = true;
            clearInterval(timer);
            
            const q = questions[currentQuestion];
            const buttons = document.querySelectorAll('#options button');
            
            // Initialize topic stats
            if (!topicStats[q.topic]) {
                topicStats[q.topic] = { correct: 0, total: 0 };
            }
            topicStats[q.topic].total++;
            
            buttons.forEach(btn => btn.disabled = true);
            
            if (selectedIndex === q.correct) {
                score++;
                topicStats[q.topic].correct++;
                if (selectedIndex >= 0) {
                    buttons[selectedIndex].style.background = '#28a745';
                    buttons[selectedIndex].innerHTML += ' ‚úÖ';
                }
            } else {
                if (selectedIndex >= 0) {
                    buttons[selectedIndex].style.background = '#dc3545';
                    buttons[selectedIndex].innerHTML += ' ‚ùå';
                }
                buttons[q.correct].style.background = '#28a745';
                buttons[q.correct].innerHTML += ' ‚úÖ';
            }
            
            document.getElementById('score').textContent = score;
            
            // Show explanation
            document.getElementById('explanation').innerHTML = 
                `<strong>Ch·ªß ƒë·ªÅ:</strong> ${q.topic}<br><strong>Gi·∫£i th√≠ch:</strong> ${q.explanation}`;
            document.getElementById('explanation').classList.add('show');
            
            setTimeout(() => {
                currentQuestion++;
                showQuestion();
            }, 3000);
        }

        function showResults() {
            clearInterval(timer);
            document.getElementById('quiz-area').style.display = 'none';
            document.getElementById('final-results').style.display = 'block';
            
            const percentage = Math.round((score / questions.length) * 100);
            document.getElementById('final-score').textContent = `${score}/${questions.length} (${percentage}%)`;
            
            // Star rating
            const stars = Math.ceil(percentage / 20);
            let starHTML = '';
            for (let i = 1; i <= 5; i++) {
                starHTML += `<span class="star ${i <= stars ? 'filled' : ''}">‚≠ê</span>`;
            }
            document.getElementById('star-rating').innerHTML = starHTML;
            
            // Performance analysis
            let analysisHTML = '<h3>üìä Ph√¢n T√≠ch K·∫øt Qu·∫£</h3><div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';
            
            for (let topic in topicStats) {
                const stat = topicStats[topic];
                const topicPercentage = Math.round((stat.correct / stat.total) * 100);
                const color = topicPercentage >= 70 ? '#28a745' : topicPercentage >= 50 ? '#ffc107' : '#dc3545';
                
                analysisHTML += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid ${color};">
                        <strong>${topic}</strong><br>
                        ${stat.correct}/${stat.total} (${topicPercentage}%)
                    </div>
                `;
            }
            analysisHTML += '</div>';
            
            document.getElementById('performance-analysis').innerHTML = analysisHTML;
            
            // Achievements
            let achievements = '';
            if (percentage >= 90) {
                achievements = '<div class="achievement">üèÜ Th·∫°c sƒ© Ng·ªØ ph√°p! B·∫°n ƒë√£ th√†nh th·∫°o!</div>';
            } else if (percentage >= 80) {
                achievements = '<div class="achievement">ü•á Chuy√™n gia! B·∫°n c√≥ ki·∫øn th·ª©c v·ªØng v√†ng!</div>';
            } else if (percentage >= 70) {
                achievements = '<div class="achievement">ü•à Kh√° t·ªët! B·∫°n ƒë√£ n·∫Øm ƒë∆∞·ª£c ph·∫ßn l·ªõn!</div>';
            } else if (percentage >= 60) {
                achievements = '<div class="achievement">ü•â C·∫ßn c·ªë g·∫Øng! H√£y √¥n l·∫°i m·ªôt s·ªë ch·ªß ƒë·ªÅ!</div>';
            } else {
                achievements = '<div style="background: #ffc107; color: #212529; padding: 15px; border-radius: 10px; text-align: center;">üìö H√£y xem l·∫°i l√Ω thuy·∫øt v√† th·ª≠ l·∫°i nh√©!</div>';
            }
            
            document.getElementById('achievements').innerHTML = achievements;
        }

        function restartQuiz() {
            document.getElementById('final-results').style.display = 'none';
            document.getElementById('quiz-start').style.display = 'block';
        }
    </script>

    <footer>
        <p>&copy; 2025 English Grammar Mastery</p>
    </footer>
</body>
</html>
